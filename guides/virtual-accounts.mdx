---
title: "Virtual Accounts Integration"
description: "Complete guide to integrating virtual accounts for payment collection"
---

## Overview

Virtual accounts allow you to receive payments from customers without needing a physical bank account. This guide covers everything you need to know to integrate virtual accounts into your application, from setup to monitoring.

## What are Virtual Accounts?

Virtual accounts are temporary or permanent bank account numbers that allow you to:

- **Receive payments** from customers in multiple currencies
- **Track transactions** in real-time with unique references
- **Automate reconciliation** with your existing systems
- **Scale globally** without local banking relationships

<CardGroup cols={2}>
  <Card title="USD Virtual Accounts" icon="dollar-sign">
    - **Features**: ACH transfers, wire transfers
    - **KYC Required**: Yes (through Persona)
    - **Settlement**: USDC on Polygon
  </Card>
  <Card title="NGN Virtual Accounts" icon="naira-sign">
    - **Features**: Local bank transfers
    - **KYC Required**: No (basic accounts)
    - **Settlement**: USDC on Polygon
  </Card>
</CardGroup>

## Getting Started

### Prerequisites

Before you can create virtual accounts, you need:

1. **Authenticated API access** - Login and get your access token
2. **Client account** - Create a business client account
3. **Settlement wallet** - For USD accounts, you need a crypto wallet for settlement

### Step 1: Create a Client Account

First, create a business client account:

<CodeGroup>

```javascript JavaScript
const client = await fetch('https://api.railsfromthecrypt.com/v1/client', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    company_name: 'Acme Corp',
    company_email: 'contact@acme.com',
    company_phone_number: '+1234567890',
    company_country: 'US'
  })
});

const clientData = await client.json();
console.log('Client created:', clientData);
```

```python Python
import requests

response = requests.post(
    'https://api.railsfromthecrypt.com/v1/client',
    headers={
        'Authorization': f'Bearer {access_token}',
        'Content-Type': 'application/json'
    },
    json={
        'company_name': 'Acme Corp',
        'company_email': 'contact@acme.com',
        'company_phone_number': '+1234567890',
        'company_country': 'US'
    }
)

client_data = response.json()
print('Client created:', client_data)
```

</CodeGroup>

### Step 2: Create Settlement Recipient (USD Only)

For USD virtual accounts, you need a crypto recipient for settlement:

<CodeGroup>

```javascript JavaScript
const recipient = await fetch('https://api.railsfromthecrypt.com/v1/recipients/crypto', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    type: 'crypto',
    wallet_address: '0x1234567890abcdef1234567890abcdef12345678',
    network: 'Polygon',
    label: 'USD Settlement Wallet',
    currency: 'USDC',
    code: '123456'
  })
});

const recipientData = await recipient.json();
console.log('Settlement recipient created:', recipientData);
```

</CodeGroup>

### Step 3: Create Virtual Account Request

Now create a virtual account request:

<CodeGroup>

```javascript JavaScript
// For USD virtual account
const usdRequest = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/requests', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    currency: 'USD',
    need_new_wallet: false,
    settlement_id: recipientData.id // From step 2
  })
});

const usdAccount = await usdRequest.json();
console.log('USD virtual account request:', usdAccount);

// For NGN virtual account
const ngnRequest = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/requests', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    currency: 'NGN',
    need_new_wallet: true
  })
});

const ngnAccount = await ngnRequest.json();
console.log('NGN virtual account request:', ngnAccount);
```

</CodeGroup>

## USD Virtual Accounts

### KYC Verification Process

USD virtual accounts require KYC verification through Persona:

<Steps>
  <Step title="Request Created">
    Virtual account request is created with `needs_action` status
  </Step>
  <Step title="KYC Link Generated">
    A verification link is provided in the response
  </Step>
  <Step title="User Completes KYC">
    User visits the link and completes identity verification
  </Step>
  <Step title="Admin Review">
    Administrators review the KYC submission
  </Step>
  <Step title="Account Approved">
    Virtual account is created and details are provided
  </Step>
</Steps>

### Handling KYC Verification

<CodeGroup>

```javascript JavaScript
async function handleUSDVirtualAccount(request) {
  if (request.verification_link) {
    // Show KYC verification to user
    const userConfirmed = confirm(
      'KYC verification is required for USD virtual account. Click OK to proceed.'
    );
    
    if (userConfirmed) {
      // Open KYC verification in new tab
      window.open(request.verification_link, '_blank');
      
      // Monitor request status
      return monitorRequestStatus(request.id);
    }
  }
  
  return request;
}

async function monitorRequestStatus(requestId) {
  const maxAttempts = 30; // 5 minutes with 10-second intervals
  let attempts = 0;
  
  while (attempts < maxAttempts) {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/virtual-accounts/requests/${requestId}`, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    const request = await response.json();
    
    if (request.status === 'approved') {
      console.log('Virtual account approved:', request.virtualAccount);
      return request;
    } else if (request.status === 'rejected') {
      throw new Error(`Request rejected: ${request.failure_reason}`);
    }
    
    // Still pending, wait and retry
    await new Promise(resolve => setTimeout(resolve, 10000));
    attempts++;
  }
  
  throw new Error('Request monitoring timeout');
}
```

</CodeGroup>

## NGN Virtual Accounts

### No KYC Required

NGN virtual accounts don't require KYC verification for basic accounts:

<CodeGroup>

```javascript JavaScript
async function createNGNVirtualAccount() {
  try {
    const response = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/requests', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        currency: 'NGN',
        need_new_wallet: true
      })
    });
    
    const request = await response.json();
    
    if (request.status === 'approved') {
      // Account is immediately available
      console.log('NGN virtual account created:', request.virtualAccount);
      return request.virtualAccount;
    } else {
      // Wait for approval
      return monitorRequestStatus(request.id);
    }
  } catch (error) {
    console.error('Failed to create NGN virtual account:', error);
    throw error;
  }
}
```

</CodeGroup>

## Using Virtual Accounts

### Display Account Details

Once you have a virtual account, display the details to your users:

<CodeGroup>

```javascript JavaScript
function displayVirtualAccount(account) {
  const accountInfo = {
    accountNumber: account.account_number,
    accountName: account.account_name,
    bankName: account.bank_name,
    routingNumber: account.routing_number, // USD only
    reference: account.reference
  };
  
  // Display to user
  document.getElementById('account-number').textContent = accountInfo.accountNumber;
  document.getElementById('account-name').textContent = accountInfo.accountName;
  document.getElementById('bank-name').textContent = accountInfo.bankName;
  
  if (accountInfo.routingNumber) {
    document.getElementById('routing-number').textContent = accountInfo.routingNumber;
  }
  
  // Show reference for tracking
  document.getElementById('reference').textContent = accountInfo.reference;
}
```

</CodeGroup>

### Payment Instructions

Provide clear payment instructions to your customers:

<CodeGroup>

```javascript JavaScript
function generatePaymentInstructions(account, amount, currency) {
  const instructions = {
    USD: {
      title: 'Payment Instructions for USD',
      steps: [
        `Account Number: ${account.account_number}`,
        `Account Name: ${account.account_name}`,
        `Bank Name: ${account.bank_name}`,
        `Routing Number: ${account.routing_number}`,
        `Amount: $${amount}`,
        `Reference: ${account.reference}`
      ],
      note: 'Use ACH transfer or wire transfer. Include the reference number in your payment.'
    },
    NGN: {
      title: 'Payment Instructions for NGN',
      steps: [
        `Account Number: ${account.account_number}`,
        `Account Name: ${account.account_name}`,
        `Bank Name: ${account.bank_name}`,
        `Amount: â‚¦${amount}`,
        `Reference: ${account.reference}`
      ],
      note: 'Use local bank transfer. Include the reference number in your payment.'
    }
  };
  
  return instructions[currency];
}
```

</CodeGroup>

## Monitoring Payments

### Real-time Payment Tracking

Use webhooks to monitor payments in real-time:

<CodeGroup>

```javascript JavaScript
// Webhook handler for payment events
app.post('/webhooks/hr', (req, res) => {
  const event = req.body;
  
  switch (event.type) {
    case 'payment.received':
      handlePaymentReceived(event.data);
      break;
    case 'payment.failed':
      handlePaymentFailed(event.data);
      break;
    default:
      console.log('Unknown event type:', event.type);
  }
  
  res.status(200).send('OK');
});

function handlePaymentReceived(data) {
  console.log('Payment received:', data);
  
  // Update your database
  updatePaymentStatus(data.reference, 'received');
  
  // Notify user
  notifyUser(data.reference, 'Payment received successfully');
  
  // Process the payment
  processPayment(data);
}

function handlePaymentFailed(data) {
  console.log('Payment failed:', data);
  
  // Update your database
  updatePaymentStatus(data.reference, 'failed');
  
  // Notify user
  notifyUser(data.reference, 'Payment failed. Please try again.');
}
```

</CodeGroup>

### Manual Payment Verification

You can also manually check for payments:

<CodeGroup>

```javascript JavaScript
async function checkPaymentStatus(reference) {
  try {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/reference/${reference}`, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    const transaction = await response.json();
    
    if (transaction.status === 'completed') {
      console.log('Payment completed:', transaction);
      return transaction;
    } else if (transaction.status === 'failed') {
      console.log('Payment failed:', transaction.reason);
      return null;
    } else {
      console.log('Payment still processing...');
      return null;
    }
  } catch (error) {
    console.error('Failed to check payment status:', error);
    return null;
  }
}
```

</CodeGroup>

## Virtual Account Management

### List All Virtual Accounts

<CodeGroup>

```javascript JavaScript
async function getVirtualAccounts() {
  try {
    const response = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/requests', {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    const requests = await response.json();
    
    // Filter for approved accounts
    const approvedAccounts = requests.filter(request => 
      request.status === 'approved' && request.virtualAccount
    );
    
    return approvedAccounts.map(request => request.virtualAccount);
  } catch (error) {
    console.error('Failed to get virtual accounts:', error);
    throw error;
  }
}
```

</CodeGroup>

### Get Account Activities

<CodeGroup>

```javascript JavaScript
async function getAccountActivities(accountId) {
  try {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/virtual-accounts/${accountId}/activities`, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    const activities = await response.json();
    return activities;
  } catch (error) {
    console.error('Failed to get account activities:', error);
    throw error;
  }
}
```

</CodeGroup>

### Get Account Metrics

<CodeGroup>

```javascript JavaScript
async function getAccountMetrics() {
  try {
    const response = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/metrics', {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    const metrics = await response.json();
    return metrics;
  } catch (error) {
    console.error('Failed to get account metrics:', error);
    throw error;
  }
}
```

</CodeGroup>

## Best Practices

### Security

<AccordionGroup>
  <Accordion title="Account Information">
    - Store virtual account details securely
    - Use HTTPS for all communications
    - Implement proper access controls
    - Log all account access
  </Accordion>
  <Accordion title="Payment Verification">
    - Always verify payment amounts
    - Check reference numbers
    - Implement duplicate payment detection
    - Use webhook signature verification
  </Accordion>
  <Accordion title="User Data">
    - Protect customer payment information
    - Implement data encryption
    - Follow PCI compliance guidelines
    - Regular security audits
  </Accordion>
</AccordionGroup>

### Performance

<AccordionGroup>
  <Accordion title="Caching">
    - Cache virtual account details
    - Implement request deduplication
    - Use appropriate cache TTL
    - Monitor cache hit rates
  </Accordion>
  <Accordion title="Monitoring">
    - Track payment success rates
    - Monitor account creation times
    - Set up alerts for failures
    - Regular performance reviews
  </Accordion>
  <Accordion title="Scalability">
    - Use connection pooling
    - Implement request queuing
    - Monitor rate limits
    - Plan for traffic spikes
  </Accordion>
</AccordionGroup>

### User Experience

<AccordionGroup>
  <Accordion title="Payment Flow">
    - Provide clear payment instructions
    - Show payment progress
    - Handle errors gracefully
    - Offer multiple payment methods
  </Accordion>
  <Accordion title="Notifications">
    - Real-time payment updates
    - Clear error messages
    - Progress indicators
    - Success confirmations
  </Accordion>
  <Accordion title="Support">
    - Help documentation
    - Contact information
    - FAQ section
    - Live chat support
  </Accordion>
</AccordionGroup>

## Common Use Cases

### E-commerce Platform

<CodeGroup>

```javascript JavaScript
class EcommercePaymentHandler {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async processOrder(order) {
    // Create virtual account for order
    const account = await this.createVirtualAccount(order.currency);
    
    // Store order with account details
    await this.storeOrder({
      ...order,
      virtualAccount: account,
      status: 'pending_payment'
    });
    
    // Send payment instructions to customer
    await this.sendPaymentInstructions(order.customer, account);
    
    return account;
  }
  
  async handlePaymentReceived(paymentData) {
    // Find order by reference
    const order = await this.findOrderByReference(paymentData.reference);
    
    if (order && paymentData.amount === order.amount) {
      // Update order status
      await this.updateOrderStatus(order.id, 'paid');
      
      // Process fulfillment
      await this.processFulfillment(order);
      
      // Notify customer
      await this.notifyCustomer(order.customer, 'Payment received');
    }
  }
}
```

</CodeGroup>

### Marketplace Application

<CodeGroup>

```javascript JavaScript
class MarketplacePaymentHandler {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async createEscrowAccount(seller, buyer, amount, currency) {
    // Create virtual account for escrow
    const account = await this.createVirtualAccount(currency);
    
    // Create escrow record
    const escrow = await this.createEscrow({
      seller,
      buyer,
      amount,
      currency,
      virtualAccount: account,
      status: 'pending_payment'
    });
    
    return { account, escrow };
  }
  
  async releaseEscrow(escrowId) {
    const escrow = await this.getEscrow(escrowId);
    
    if (escrow.status === 'paid') {
      // Create transfer to seller
      const transfer = await this.createTransfer({
        amount: escrow.amount,
        currency: escrow.currency,
        recipient: escrow.seller
      });
      
      // Update escrow status
      await this.updateEscrowStatus(escrowId, 'released');
      
      return transfer;
    }
  }
}
```

</CodeGroup>

## Troubleshooting

### Common Issues

<CardGroup cols={2}>
  <Card title="Account Creation Failed" icon="exclamation-triangle">
    - Check client account status
    - Verify settlement wallet (USD)
    - Ensure sufficient permissions
    - Contact support if persistent
  </Card>
  <Card title="KYC Verification Issues" icon="shield-exclamation">
    - Verify verification link is valid
    - Check user completed all steps
    - Allow time for admin review
    - Contact support for status updates
  </Card>
  <Card title="Payment Not Received" icon="clock">
    - Verify account details are correct
    - Check payment reference number
    - Allow processing time (1-3 days)
    - Contact support with transaction details
  </Card>
  <Card title="Webhook Not Received" icon="webhook">
    - Verify webhook URL is accessible
    - Check webhook is active
    - Review webhook logs
    - Test webhook endpoint
  </Card>
</CardGroup>

### Error Handling

<CodeGroup>

```javascript JavaScript
async function handleVirtualAccountError(error) {
  switch (error.code) {
    case 'INVALID_CURRENCY':
      return 'Currency not supported for virtual accounts';
    case 'MISSING_SETTLEMENT':
      return 'Settlement wallet required for USD accounts';
    case 'INSUFFICIENT_PERMISSIONS':
      return 'Account does not have permission to create virtual accounts';
    case 'DUPLICATE_REQUEST':
      return 'Similar request already exists';
    default:
      return 'An unexpected error occurred. Please try again.';
  }
}
```

</CodeGroup>

## Support

### Getting Help

If you need assistance with virtual accounts:

1. **Check the documentation** - Review this guide and API reference
2. **Test in staging** - Use the staging environment for testing
3. **Review error logs** - Check your application logs for errors
4. **Contact support** - Email [support@hashrails.xyz](mailto:support@hashrails.xyz)

### Resources

<CardGroup cols={2}>
  <Card
    title="API Reference"
    icon="book"
    href="/api/virtual-accounts/requests"
  >
    Complete API documentation for virtual accounts
  </Card>
  <Card
    title="Webhooks Guide"
    icon="webhook"
    href="/concepts/webhooks"
  >
    Set up real-time payment notifications
  </Card>
  <Card
    title="Error Handling"
    icon="exclamation-triangle"
    href="/concepts/error-handling"
  >
    Handle errors and edge cases
  </Card>
  <Card
    title="Support"
    icon="headset"
    href="mailto:support@hashrails.xyz"
  >
    Get help from our support team
  </Card>
</CardGroup>
